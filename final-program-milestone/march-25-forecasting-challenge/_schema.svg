{
   "$schema": "https://vega.github.io/schema/vega/v5.json",
   "width": 500,
   "height": 300,
   "scales": [
      {
         "name": "xscale",
         "type": "linear",
         "range": "width",
         "zero": false,
         "domain": {
            "fields": [
               {
                  "data": "distributions",
                  "field": "timepoint"
               },
               {
                  "data": "traces",
                  "field": "timepoint"
               },
               {
                  "data": "points",
                  "field": "timepoint"
               }
            ]
         }
      },
      {
         "name": "yscale",
         "type": "linear",
         "range": "height",
         "nice": true,
         "zero": true,
         "domain": {
            "fields": [
               {
                  "data": "distributions",
                  "field": "lower"
               },
               {
                  "data": "distributions",
                  "field": "upper"
               },
               {
                  "data": "traces",
                  "field": "value"
               },
               {
                  "data": "points",
                  "field": "value"
               }
            ]
         }
      },
      {
         "name": "markerscale_v",
         "type": "ordinal",
         "domain": {
            "data": "markers_v",
            "field": "label"
         },
         "range": {
            "data": "markers_v",
            "field": "new_color"
         }
      },
      {
         "name": "markerscale_h",
         "type": "ordinal",
         "domain": {
            "data": "markers_h",
            "field": "label"
         },
         "range": {
            "data": "markers_h",
            "field": "new_color"
         }
      },
      {
         "name": "fillScale",
         "type": "ordinal",
         "domain": [
            "I_u_state",
            "I_v_state"
         ],
         "range": [
            "#1f77b4",
            "#ff7f0e"
         ]
      },
      {
         "name": "color",
         "type": "ordinal",
         "range": [
            "#1f77b4",
            "#ff7f0e"
         ],
         "domain": [
            "I_u_state",
            "I_v_state"
         ]
      },
      {
         "name": "lineStyle_v",
         "type": "ordinal",
         "domain": {
            "data": "markers_v",
            "field": "label"
         },
         "range": {
            "data": "markers_v",
            "field": "type"
         }
      },
      {
         "name": "lineStyle_h",
         "type": "ordinal",
         "domain": {
            "data": "markers_h",
            "field": "label"
         },
         "range": {
            "data": "markers_h",
            "field": "type"
         }
      },
      {
         "name": "trajectoryOrder",
         "type": "ordinal",
         "domain": [
            "I_u_state",
            "I_v_state"
         ],
         "range": [
            0,
            1
         ]
      }
   ],
   "axes": [
      {
         "orient": "bottom",
         "scale": "xscale",
         "zindex": 100,
         "title": {
            "signal": "data('axis_labels')[0].xaxis_label"
         }
      },
      {
         "orient": "left",
         "scale": "yscale",
         "zindex": 100,
         "title": {
            "signal": "data('axis_labels')[0].yaxis_label"
         }
      }
   ],
   "signals": [
      {
         "name": "clear",
         "value": true,
         "on": [
            {
               "events": "mouseup[!event.item]",
               "update": "true",
               "force": true
            }
         ]
      },
      {
         "name": "shift",
         "value": false,
         "on": [
            {
               "events": "@legendSymbol:click, @legendLabel:click",
               "update": "event.shiftKey",
               "force": true
            }
         ]
      },
      {
         "name": "clicked",
         "value": null,
         "on": [
            {
               "events": "@legendSymbol:click, @legendLabel:click",
               "update": "{value: datum.value}",
               "force": true
            }
         ]
      },
      {
         "name": "clearData",
         "value": true,
         "on": [
            {
               "events": "mouseup[!event.item]",
               "update": "true",
               "force": true
            }
         ]
      },
      {
         "name": "clickedData",
         "value": null,
         "on": [
            {
               "events": "@area:click",
               "update": "{value: datum.trajectory}",
               "force": true
            }
         ]
      },
      {
         "name": "logLegendClick",
         "value": null,
         "on": [
            {
               "events": "@legendSymbol:click, @legendLabel:click",
               "update": "{datum: datum}",
               "force": true
            }
         ]
      },
      {
         "description": "Active datapoint",
         "name": "activated_datapoint",
         "value": null,
         "on": [
            {
               "events": "symbol:mouseover",
               "update": "item()"
            },
            {
               "events": "symbol:mouseout",
               "update": "null"
            }
         ]
      },
      {
         "name": "logAreaClick",
         "value": null,
         "on": [
            {
               "events": "@area:click",
               "update": "{datum: datum}",
               "force": true
            }
         ]
      }
   ],
   "config": {
      "logLevel": "warn"
   },
   "legends": [
      {
         "name": "color_legend",
         "fill": "fillScale",
         "stroke": "color",
         "title": "Trajectory States",
         "type": "symbol",
         "symbolType": "square",
         "symbolSize": 200,
         "encode": {
            "symbols": {
               "enter": {
                  "shape": {
                     "value": "square"
                  },
                  "size": {
                     "value": 200
                  },
                  "fill": {
                     "scale": "fillScale",
                     "field": "trajectory"
                  },
                  "stroke": {
                     "scale": "color",
                     "field": "trajectory"
                  },
                  "strokeWidth": {
                     "value": 2
                  }
               },
               "update": {
                  "opacity": [
                     {
                        "test": "!length(data('selected')) || indata('selected', 'value', datum.trajectory) || indata('selectedData', 'value', datum.trajectory)",
                        "value": 0.7
                     },
                     {
                        "value": 0.15
                     }
                  ]
               }
            },
            "labels": {
               "update": {
                  "opacity": [
                     {
                        "test": "!length(data('selectedData')) || indata('selectedData', 'value', datum.trajectory)",
                        "value": 1
                     },
                     {
                        "value": 0.25
                     }
                  ]
               }
            }
         }
      },
      {
         "name": "marker_color_legend_v",
         "stroke": "markerscale_v",
         "strokeDash": "lineStyle_v",
         "title": {
            "signal": "length(data('markers_v')) > 1 ? 'Vertical Markers' : ''"
         },
         "interactive": true,
         "encode": {
            "symbols": {
               "enter": {
                  "shape": {
                     "value": "square"
                  },
                  "stroke": {
                     "scale": "markerscale_v",
                     "field": "label"
                  },
                  "strokeDash": {
                     "scale": "lineStyle_v",
                     "field": "type"
                  },
                  "strokeWidth": {
                     "value": 1
                  },
                  "size": {
                     "value": 200
                  },
                  "opacity": {
                     "value": 1
                  }
               },
               "update": {
                  "opacity": [
                     {
                        "test": "length(data('markers_v')) > 1",
                        "value": 1
                     },
                     {
                        "value": 0
                     }
                  ]
               }
            },
            "labels": {
               "update": {
                  "text": {
                     "field": "label"
                  },
                  "fill": {
                     "value": "black"
                  },
                  "opacity": [
                     {
                        "test": "length(data('markers_v')) > 1",
                        "value": 1
                     },
                     {
                        "value": 0
                     }
                  ]
               }
            }
         }
      },
      {
         "name": "marker_color_legend_h",
         "stroke": "markerscale_h",
         "strokeDash": "lineStyle_h",
         "title": {
            "signal": "length(data('markers_h')) > 1 ? 'Vertical Markers' : ''"
         },
         "interactive": true,
         "encode": {
            "symbols": {
               "enter": {
                  "shape": {
                     "value": "square"
                  },
                  "stroke": {
                     "scale": "markerscale_v",
                     "field": "label"
                  },
                  "strokeDash": {
                     "scale": "lineStyle_h",
                     "field": "type"
                  },
                  "strokeWidth": {
                     "value": 1
                  },
                  "size": {
                     "value": 200
                  },
                  "opacity": {
                     "value": 1
                  }
               },
               "update": {
                  "opacity": [
                     {
                        "test": "length(data('markers_h')) > 1",
                        "value": 1
                     },
                     {
                        "value": 0
                     }
                  ]
               }
            },
            "labels": {
               "update": {
                  "text": {
                     "field": "label"
                  },
                  "fill": {
                     "value": "black"
                  },
                  "opacity": [
                     {
                        "test": "length(data('markers_h')) > 1",
                        "value": 1
                     },
                     {
                        "value": 0
                     }
                  ]
               }
            }
         }
      }
   ],
   "marks": [
      {
         "type": "group",
         "zindex": 3,
         "name": "_points",
         "from": {
            "facet": {
               "name": "points_split",
               "data": "points",
               "groupby": "trajectory"
            }
         },
         "marks": [
            {
               "type": "symbol",
               "name": "_points_symbol",
               "from": {
                  "data": "points_split"
               },
               "zindex": 3,
               "encode": {
                  "update": {
                     "x": {
                        "scale": "xscale",
                        "field": "timepoint"
                     },
                     "y": {
                        "scale": "yscale",
                        "field": "value"
                     },
                     "size": {
                        "value": 35
                     },
                     "strokeWidth": {
                        "value": 2
                     },
                     "stroke": {
                        "scale": "color",
                        "field": "trajectory"
                     },
                     "fillOpacity": [
                        {
                           "test": "!length(data('selected')) || indata('selected', 'value', datum.trajectory)",
                           "value": 0.5
                        },
                        {
                           "value": 0.15
                        }
                     ],
                     "strokeOpacity": [
                        {
                           "test": "!length(data('selected')) || indata('selected', 'value', datum.trajectory)",
                           "value": 0.75
                        },
                        {
                           "value": 0.15
                        }
                     ],
                     "tooltip": {
                        "field": "value"
                     }
                  },
                  "hover": {
                     "fillOpacity": {
                        "value": 0.9
                     }
                  }
               }
            },
            {
               "type": "line",
               "name": "_points_line",
               "from": {
                  "data": "points_split"
               },
               "zindex": 3,
               "encode": {
                  "update": {
                     "x": {
                        "scale": "xscale",
                        "field": "timepoint"
                     },
                     "y": {
                        "scale": "yscale",
                        "field": "value"
                     },
                     "strokeWidth": {
                        "value": 2
                     },
                     "stroke": {
                        "scale": "color",
                        "field": "trajectory"
                     },
                     "interpolate": {
                        "value": "linear"
                     },
                     "strokeDash": {
                        "value": [
                           5,
                           3
                        ]
                     },
                     "strokeOpacity": [
                        {
                           "test": "!length(data('selected')) || indata('selected', 'value', datum.trajectory)",
                           "value": 0.3
                        },
                        {
                           "value": 0.1
                        }
                     ]
                  },
                  "hover": {
                     "fillOpacity": {
                        "value": 0.9
                     }
                  }
               }
            }
         ]
      },
      {
         "type": "group",
         "zindex": 2,
         "name": "_traces",
         "from": {
            "facet": {
               "name": "traces_split",
               "data": "traces",
               "groupby": "trajectory"
            }
         },
         "marks": [
            {
               "type": "line",
               "name": "_traces_lines",
               "from": {
                  "data": "traces_split"
               },
               "encode": {
                  "update": {
                     "x": {
                        "scale": "xscale",
                        "field": "timepoint"
                     },
                     "y": {
                        "scale": "yscale",
                        "field": "value"
                     },
                     "strokeWidth": {
                        "value": 2
                     },
                     "stroke": {
                        "scale": "color",
                        "field": "trajectory"
                     },
                     "interpolate": {
                        "value": "linear"
                     },
                     "strokeOpacity": [
                        {
                           "test": "!length(data('selected')) || indata('selected', 'value', datum.trajectory)",
                           "value": 0.75
                        },
                        {
                           "value": 0.15
                        }
                     ]
                  },
                  "hover": {
                     "fillOpacity": {
                        "value": 0.9
                     }
                  }
               }
            }
         ]
      },
      {
         "type": "group",
         "name": "_distributions",
         "zindex": 1,
         "from": {
            "facet": {
               "name": "trajectory_split",
               "data": "distributions",
               "groupby": "trajectory_order"
            }
         },
         "sort": {
            "field": "datum.trajectory_order",
            "order": "ascending"
         },
         "marks": [
            {
               "type": "area",
               "name": "area",
               "interactive": true,
               "from": {
                  "data": "trajectory_split"
               },
               "encode": {
                  "update": {
                     "x": {
                        "scale": "xscale",
                        "field": "timepoint"
                     },
                     "y": {
                        "scale": "yscale",
                        "field": "upper"
                     },
                     "y2": {
                        "scale": "yscale",
                        "field": "lower"
                     },
                     "interpolate": {
                        "value": "linear"
                     },
                     "strokeWidth": {
                        "value": 2
                     },
                     "fill": {
                        "scale": "fillScale",
                        "field": "trajectory"
                     },
                     "stroke": {
                        "scale": "color",
                        "field": "trajectory"
                     },
                     "fillOpacity": [
                        {
                           "test": "!length(data('selected')) || indata('selected', 'value', datum.trajectory)",
                           "value": 0.5
                        },
                        {
                           "value": 0.15
                        }
                     ],
                     "strokeOpacity": [
                        {
                           "test": "!length(data('selected')) || indata('selected', 'value', datum.trajectory)",
                           "value": 0.75
                        },
                        {
                           "value": 0.15
                        }
                     ]
                  },
                  "hover": {
                     "fillOpacity": {
                        "value": 0.9
                     }
                  }
               }
            }
         ]
      },
      {
         "type": "group",
         "name": "_markers_v",
         "marks": [
            {
               "type": "rule",
               "name": "_marker_v text",
               "from": {
                  "data": "markers_v"
               },
               "encode": {
                  "enter": {
                     "stroke": {
                        "scale": "markerscale_v",
                        "field": "label"
                     },
                     "strokeDash": {
                        "scale": "lineStyle_v",
                        "field": "label"
                     }
                  },
                  "update": {
                     "x": {
                        "scale": "xscale",
                        "field": "axis_value"
                     },
                     "y2": {
                        "value": 0
                     },
                     "y": {
                        "signal": "height"
                     },
                     "opacity": {
                        "value": 1
                     }
                  }
               }
            }
         ]
      },
      {
         "type": "group",
         "name": "_markers_h",
         "marks": [
            {
               "type": "rule",
               "name": "_marker_h text",
               "from": {
                  "data": "markers_h"
               },
               "encode": {
                  "enter": {
                     "stroke": {
                        "scale": "markerscale_h",
                        "field": "label"
                     },
                     "strokeDash": {
                        "scale": "lineStyle_h",
                        "field": "label"
                     }
                  },
                  "update": {
                     "y": {
                        "scale": "yscale",
                        "field": "axis_value"
                     },
                     "x2": {
                        "value": 0
                     },
                     "x": {
                        "signal": "width"
                     },
                     "opacity": {
                        "value": 1
                     }
                  }
               }
            }
         ]
      }
   ],
   "data": [
      {
         "name": "distributions",
         "values": [
            {
               "trajectory": "I_u_state",
               "timepoint": 0.0,
               "lower": 1785.0,
               "upper": 1785.0
            },
            {
               "trajectory": "I_u_state",
               "timepoint": 1.0,
               "lower": 3574.9467895507814,
               "upper": 3937.2291870117188
            },
            {
               "trajectory": "I_u_state",
               "timepoint": 2.0,
               "lower": 4049.7309448242186,
               "upper": 4597.7215576171875
            },
            {
               "trajectory": "I_u_state",
               "timepoint": 3.0,
               "lower": 4702.883276367187,
               "upper": 5451.553491210937
            },
            {
               "trajectory": "I_u_state",
               "timepoint": 4.0,
               "lower": 5494.178198242187,
               "upper": 6528.274487304688
            },
            {
               "trajectory": "I_u_state",
               "timepoint": 5.0,
               "lower": 6401.622875976563,
               "upper": 7768.268383789063
            },
            {
               "trajectory": "I_u_state",
               "timepoint": 6.0,
               "lower": 7429.1905517578125,
               "upper": 9219.622216796875
            },
            {
               "trajectory": "I_u_state",
               "timepoint": 7.0,
               "lower": 8602.925244140624,
               "upper": 10960.947314453124
            },
            {
               "trajectory": "I_u_state",
               "timepoint": 8.0,
               "lower": 9934.012255859376,
               "upper": 12982.72783203125
            },
            {
               "trajectory": "I_u_state",
               "timepoint": 9.0,
               "lower": 11447.51376953125,
               "upper": 15296.7208984375
            },
            {
               "trajectory": "I_u_state",
               "timepoint": 10.0,
               "lower": 13126.370556640624,
               "upper": 17866.965625
            },
            {
               "trajectory": "I_u_state",
               "timepoint": 11.0,
               "lower": 14919.9490234375,
               "upper": 20685.3630859375
            },
            {
               "trajectory": "I_u_state",
               "timepoint": 12.0,
               "lower": 16891.8341796875,
               "upper": 23721.6982421875
            },
            {
               "trajectory": "I_v_state",
               "timepoint": 0.0,
               "lower": 315.0,
               "upper": 315.0
            },
            {
               "trajectory": "I_v_state",
               "timepoint": 1.0,
               "lower": 1091.0480590820312,
               "upper": 1202.441229248047
            },
            {
               "trajectory": "I_v_state",
               "timepoint": 2.0,
               "lower": 1519.1450134277343,
               "upper": 1725.5186340332032
            },
            {
               "trajectory": "I_v_state",
               "timepoint": 3.0,
               "lower": 2010.6148681640625,
               "upper": 2332.284948730469
            },
            {
               "trajectory": "I_v_state",
               "timepoint": 4.0,
               "lower": 2627.500927734375,
               "upper": 3116.8510498046876
            },
            {
               "trajectory": "I_v_state",
               "timepoint": 5.0,
               "lower": 3411.6436767578125,
               "upper": 4133.573046875
            },
            {
               "trajectory": "I_v_state",
               "timepoint": 6.0,
               "lower": 4388.716479492187,
               "upper": 5436.28095703125
            },
            {
               "trajectory": "I_v_state",
               "timepoint": 7.0,
               "lower": 5615.1431640625,
               "upper": 7116.960839843749
            },
            {
               "trajectory": "I_v_state",
               "timepoint": 8.0,
               "lower": 7151.49912109375,
               "upper": 9305.005615234375
            },
            {
               "trajectory": "I_v_state",
               "timepoint": 9.0,
               "lower": 9066.80146484375,
               "upper": 12091.86611328125
            },
            {
               "trajectory": "I_v_state",
               "timepoint": 10.0,
               "lower": 11455.972900390625,
               "upper": 15609.4640625
            },
            {
               "trajectory": "I_v_state",
               "timepoint": 11.0,
               "lower": 14386.86220703125,
               "upper": 19949.7203125
            },
            {
               "trajectory": "I_v_state",
               "timepoint": 12.0,
               "lower": 17902.39150390625,
               "upper": 25270.905859374998
            }
         ],
         "transform": [
            {
               "type": "collect",
               "sort": {
                  "field": [
                     "trajectory",
                     "timepoint"
                  ]
               }
            },
            {
               "type": "formula",
               "expr": "scale('trajectoryOrder', datum.trajectory)",
               "as": "trajectory_order"
            }
         ]
      },
      {
         "name": "traces",
         "values": [],
         "transform": [
            {
               "type": "filter",
               "expr": "isValid(datum.value)"
            },
            {
               "type": "collect",
               "sort": {
                  "field": [
                     "trajectory",
                     "timepoint"
                  ]
               }
            }
         ]
      },
      {
         "name": "points",
         "values": []
      },
      {
         "name": "markers_v",
         "values": []
      },
      {
         "name": "markers_h",
         "values": []
      },
      {
         "name": "axis_labels",
         "values": {
            "xaxis_label": "Time (weeks)",
            "yaxis_label": "Population"
         }
      },
      {
         "name": "selected",
         "on": [
            {
               "trigger": "clear",
               "remove": true
            },
            {
               "trigger": "!shift",
               "remove": true
            },
            {
               "trigger": "!shift && clicked",
               "insert": "clicked"
            },
            {
               "trigger": "shift && clicked",
               "toggle": "clicked"
            }
         ]
      },
      {
         "name": "selectedData",
         "on": [
            {
               "trigger": "clearData",
               "remove": true
            },
            {
               "trigger": "clickedData",
               "toggle": "clickedData"
            }
         ]
      }
   ],
   "title": {
      "text": [
         "Prior distribution Pennsylvania"
      ]
   }
}